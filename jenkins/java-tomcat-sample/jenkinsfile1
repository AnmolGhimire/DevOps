pipeline{
    agent any
    stages{
        stage('build'){
            steps{
                sh 'mvn -f jenkins/java-tomcat-sample/pom.xml clean package'
            }
            post{
                success{
                    echo "archieve artifacts"
                    archiveArtifacts artifacts: '**/*.war', followSymlinks: false
                }
            }
        }
    }
        stage('create tomcat image'){
            steps{
                copyArtifacts filter: '**/*.war', fingerprintArtifacts: true, projectName: env.JOB_NAME, selector: specific(env.BUILD_NUMBER)
                echo "building docker image"
                sh '''
                original_pwd = $(pwd -P)
                cd jenkins/java-tomcat-sample
                docker build -t localtomcatimg:$BUILD_NUMBER .
                cd original_pwd
                sh '''
            }

        }
}
